<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dear Diary - Smart Diary Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="header-nav">
                <!-- ç½‘ç«™æ ‡é¢˜ (å¯ç‚¹å‡»è·³è½¬ä¸»é¡µ) -->
                <div class="logo-section">
                    <a href="#" class="logo-link" data-page="home">
                        <h1 class="logo">
                            Dear Diary
                        </h1>
                    </a>
                </div>
                
                <!-- ä¸»å¯¼èˆªèœå• -->
                <nav class="main-nav">
                    <a href="#" class="nav-item" data-page="myDiary">
                        <i class="fas fa-book"></i>
                        <span data-i18n="nav_my_diary">My Diary</span>
                    </a>
                    <a href="#" class="nav-item" data-page="todos">
                        <i class="fas fa-tasks"></i>
                        <span data-i18n="nav_todos">Todos</span>
                    </a>
                    <a href="#" class="nav-item" data-page="settings">
                        <i class="fas fa-cog"></i>
                        <span data-i18n="nav_settings">Settings</span>
                    </a>
                </nav>
                
                <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
                <div class="language-switcher">
                    <button class="lang-toggle-btn" id="langToggleBtn" title="Switch to Chinese">
                        <span class="flag">ğŸ‡¨ğŸ‡³</span>
                        <span class="lang-text">ä¸­æ–‡</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ (å†™æ—¥è®°é¦–é¡µ) -->
        <main class="main-content">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <section class="input-section">
                <div class="input-container">
                    <h2 class="section-title">
                        <i class="fas fa-microphone"></i>
                        <span data-i18n="tell_me_your_day">Tell me about your day</span>
                    </h2>
                    
                    <!-- è¯­éŸ³/æ–‡æœ¬è¾“å…¥ -->
                    <div class="input-controls">
                        <div class="input-methods">
                            <button class="method-btn active" id="voiceInputBtn">
                                <i class="fas fa-microphone"></i>
                                <span data-i18n="voice_input">Voice Input</span>
                            </button>
                            <button class="method-btn" id="textInputBtn">
                                <i class="fas fa-keyboard"></i>
                                <span data-i18n="text_input">Text Input</span>
                            </button>
                        </div>
                    </div>

                    <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
                    <div class="text-input-area hidden" id="textInputArea">
                        <textarea 
                            id="userInput" 
                            data-i18n-placeholder="input_placeholder"
                            placeholder="Type your thoughts, what happened today, plans, etc..."
                            rows="6"></textarea>
                        <div class="input-actions">
                            <button class="btn btn-secondary" id="clearBtn">
                                <i class="fas fa-eraser"></i>
                                <span data-i18n="clear">Clear</span>
                            </button>
                            <button class="btn btn-primary" id="processBtn">
                                <i class="fas fa-magic"></i>
                                <span data-i18n="generate_diary">Generate Diary</span>
                            </button>
                        </div>
                    </div>

                    <!-- è¯­éŸ³è¾“å…¥åŒºåŸŸ -->
                    <div class="voice-input-area" id="voiceInputArea">
                        <div class="voice-controls">
                            <button class="voice-btn" id="startRecordBtn">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="voice-btn recording hidden" id="stopRecordBtn">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                        <div class="voice-status" id="voiceStatus" data-i18n="ready_to_record">
                            Ready to record...
                        </div>
                        <div class="transcribed-text" id="transcribedText"></div>
                        <div class="input-actions">
                            <button class="btn btn-secondary" id="clearVoiceBtn">
                                <i class="fas fa-eraser"></i>
                                <span data-i18n="clear">Clear</span>
                            </button>
                            <button class="btn btn-primary" id="processVoiceBtn">
                                <i class="fas fa-magic"></i>
                                <span data-i18n="generate_diary">Generate Diary</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
            <div class="loading-overlay hidden" id="loadingOverlay">
                <div class="loading-spinner">
                    <i class="fas fa-sync fa-spin"></i>
                    <p data-i18n="ai_analyzing">AI is analyzing your content...</p>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <section class="results-section hidden" id="resultsSection">
                <!-- æ—¥è®°é¢„è§ˆ -->
                <div class="result-card" id="diaryPreview">
                    <h3 class="card-title">
                        <i class="fas fa-book"></i>
                        <span data-i18n="generated_diary">Generated Diary</span>
                    </h3>
                    <div class="diary-content" id="diaryContent">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„æ—¥è®°å†…å®¹ -->
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-secondary" id="editDiaryBtn">
                            <i class="fas fa-edit"></i>
                            <span data-i18n="edit_diary">Edit</span>
                        </button>
                    </div>
                </div>

                <!-- å¾…åŠäº‹é¡¹é¢„è§ˆ -->
                <div class="result-card" id="todosPreview">
                    <h3 class="card-title">
                        <i class="fas fa-tasks"></i>
                        <span data-i18n="extracted_todos">Extracted Todos</span>
                    </h3>
                    <div class="todos-content" id="todosContent">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„å¾…åŠäº‹é¡¹ -->
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-secondary" id="editTodosBtn">
                            <i class="fas fa-edit"></i>
                            <span data-i18n="edit_todos">Edit</span>
                        </button>
                        <button class="btn btn-primary" id="setRemindersBtn">
                            <i class="fas fa-bell"></i>
                            <span data-i18n="set_reminders">Set Reminders</span>
                        </button>
                    </div>
                </div>

                <!-- ç¡®è®¤æ“ä½œ -->
                <div class="confirmation-actions">
                    <button class="btn btn-large btn-secondary" id="discardBtn">
                        <i class="fas fa-times"></i>
                        <span data-i18n="discard">Start Over</span>
                    </button>
                    <button class="btn btn-large btn-success" id="confirmBtn">
                        <i class="fas fa-check"></i>
                        <span data-i18n="confirm_save">Confirm Save</span>
                    </button>
                </div>
            </section>
        </main>

        <!-- æˆ‘çš„æ—¥è®°é¡µé¢ -->
        <div class="page-container hidden" id="myDiaryPage">
            <h2 data-i18n="my_diary">My Diary</h2>
            <div class="diary-list" id="diaryList">
                <!-- åŠ¨æ€åŠ è½½æ—¥è®°åˆ—è¡¨ -->
            </div>
        </div>

        <!-- å¾…åŠäº‹é¡¹é¡µé¢ -->
        <div class="page-container hidden" id="todosPage">
            <h2 data-i18n="my_todos">Todos</h2>
            <div class="todos-list" id="todosList">
                <!-- åŠ¨æ€åŠ è½½å¾…åŠäº‹é¡¹åˆ—è¡¨ -->
            </div>
        </div>

        <div class="page-container hidden" id="settingsPage">
            <h2 data-i18n="settings_title">Settings</h2>
            <div class="settings-content">
                <div class="setting-group">
                    <h3 data-i18n="reminder_settings">Reminder Settings</h3>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="enableReminders" checked>
                            <span data-i18n="enable_reminders">Enable Reminders</span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <span data-i18n="default_reminder_offset">é»˜è®¤æé†’æ—¶é—´æå‰ï¼š</span>
                            <select id="defaultReminderOffset">
                                <option value="5" data-i18n="5_minutes">5 minutes</option>
                                <option value="15" selected data-i18n="15_minutes">15 minutes</option>
                                <option value="30" data-i18n="30_minutes">30 minutes</option>
                                <option value="60" data-i18n="1_hour">1 hour</option>
                            </select>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3 data-i18n="theme_settings">Theme Settings</h3>
                    <div class="setting-item theme-selector">
                        <label>
                            <span data-i18n="choose_theme">Choose Theme:</span>
                        </label>
                        <div class="theme-options">
                            <div class="theme-option selected" data-theme="pink">
                                <div class="theme-preview pink">
                                    <div class="color-bar" style="background: #000000;"></div>
                                    <div class="color-bar" style="background: #fe67c5;"></div>
                                    <div class="color-bar" style="background: #d33d97;"></div>
                                    <div class="color-bar" style="background: #f7edeb;"></div>
                                </div>
                                <span data-i18n="theme_pink">Pink Theme</span>
                            </div>
                            
                            <div class="theme-option" data-theme="purple">
                                <div class="theme-preview purple">
                                    <div class="color-bar" style="background: #10002b;"></div>
                                    <div class="color-bar" style="background: #7b2cbf;"></div>
                                    <div class="color-bar" style="background: #c77dff;"></div>
                                    <div class="color-bar" style="background: #e0aaff;"></div>
                                </div>
                                <span data-i18n="theme_purple">Purple Theme</span>
                            </div>
                            
                            <div class="theme-option" data-theme="green">
                                <div class="theme-preview green">
                                    <div class="color-bar" style="background: #464e47;"></div>
                                    <div class="color-bar" style="background: #568259;"></div>
                                    <div class="color-bar" style="background: #96e6b3;"></div>
                                    <div class="color-bar" style="background: #f1fffa;"></div>
                                </div>
                                <span data-i18n="theme_green">Green Theme</span>
                            </div>
                            
                            <div class="theme-option" data-theme="warm">
                                <div class="theme-preview warm">
                                    <div class="color-bar" style="background: #7f5539;"></div>
                                    <div class="color-bar" style="background: #b08968;"></div>
                                    <div class="color-bar" style="background: #ddb892;"></div>
                                    <div class="color-bar" style="background: #ede0d4;"></div>
                                </div>
                                <span data-i18n="theme_warm">Warm Theme</span>
                            </div>
                            
                            <div class="theme-option" data-theme="cool">
                                <div class="theme-preview cool">
                                    <div class="color-bar" style="background: #0d1b2a;"></div>
                                    <div class="color-bar" style="background: #415a77;"></div>
                                    <div class="color-bar" style="background: #778da9;"></div>
                                    <div class="color-bar" style="background: #e0e1dd;"></div>
                                </div>
                                <span data-i18n="theme_cool">Cool Theme</span>
                            </div>
                            
                            <div class="theme-option" data-theme="gray">
                                <div class="theme-preview gray">
                                    <div class="color-bar" style="background: #212529;"></div>
                                    <div class="color-bar" style="background: #495057;"></div>
                                    <div class="color-bar" style="background: #adb5bd;"></div>
                                    <div class="color-bar" style="background: #f8f9fa;"></div>
                                </div>
                                <span data-i18n="theme_gray">Gray Theme</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3 data-i18n="app_settings">App Settings</h3>
                    <div class="setting-item">
                        <button class="btn btn-primary" id="testReminderBtn">
                            <i class="fas fa-bell"></i>
                            <span data-i18n="test_reminder">Test Reminder</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal" id="reminderModal">
            <div class="modal-header">
                <h3>Set Reminder Time</h3>
                <button class="modal-close" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="reminder-form" id="reminderForm">
                    <!-- åŠ¨æ€ç”Ÿæˆæé†’è®¾ç½®è¡¨å• -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelReminderBtn">Cancel</button>
                <button class="btn btn-primary" id="saveRemindersBtn">Save Reminders</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="notification-icon"></i>
            <span class="notification-message"></span>
        </div>
        <button class="notification-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script>
        // å…¼å®¹æ€§æ£€æµ‹å’Œè‡ªåŠ¨é‡å®šå‘
        (function() {
            var hasRequiredFeatures = true;
            var missingFeatures = [];
            
            // æ£€æŸ¥åŸºæœ¬åŠŸèƒ½
            if (!window.localStorage) {
                hasRequiredFeatures = false;
                missingFeatures.push('localStorage');
            }
            
            if (!window.addEventListener) {
                hasRequiredFeatures = false;
                missingFeatures.push('addEventListener');
            }
            
            if (!document.querySelector) {
                hasRequiredFeatures = false;
                missingFeatures.push('querySelector');
            }
            
            // æ£€æŸ¥ JSON æ”¯æŒ
            if (!window.JSON) {
                hasRequiredFeatures = false;
                missingFeatures.push('JSON');
            }
            
            // å¦‚æœç¼ºå°‘å…³é”®åŠŸèƒ½ï¼Œé‡å®šå‘åˆ°å…¼å®¹ç‰ˆæœ¬
            if (!hasRequiredFeatures) {
                console.warn('ç¼ºå°‘å¿…è¦åŠŸèƒ½:', missingFeatures);
                console.log('é‡å®šå‘åˆ°å…¼å®¹ç‰ˆæœ¬...');
                window.location.href = 'fallback.html';
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨å…¼å®¹æ¨¡å¼
            if (localStorage.getItem('dearDiary_forceCompatibility') === 'true') {
                console.log('å¼ºåˆ¶å…¼å®¹æ¨¡å¼ï¼Œé‡å®šå‘åˆ°å…¼å®¹ç‰ˆæœ¬...');
                window.location.href = 'fallback.html';
                return;
            }
            
            console.log('æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡ï¼ŒåŠ è½½å®Œæ•´ç‰ˆæœ¬...');
        })();
    </script>
    <script src="js/i18n.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/speech.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>